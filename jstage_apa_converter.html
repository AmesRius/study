<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J-STAGE APAコンバーター</title>
    <!-- Tailwind CSS CDNをロード -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* カスタムスクロールバー */
        #output-apa-container::-webkit-scrollbar { width: 8px; }
        #output-apa-container::-webkit-scrollbar-thumb { background-color: #4f46e5; border-radius: 4px; }
        #output-apa-container::-webkit-scrollbar-track { background: #f3f4f6; }

        /* スタイリッシュなフォント設定 */
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }

        /* 視覚的な階層を強調するためのフォーカススタイル */
        .input-focus:focus {
            border-color: #4f46e5 !important;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.4);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#4f46e5', // Indigo 600
                        'accent-red': '#ef4444', // Red 500
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-10 antialiased">
    <div class="max-w-5xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-800 mb-2 tracking-tight">
                J-STAGE → APA形式 変換ツール
            </h1>
            <p class="text-gray-500 text-lg">J-STAGEからコピーした文献テキストをAPAスタイルに自動変換します。</p>
        </header>

        <div class="bg-white p-6 sm:p-10 rounded-2xl shadow-2xl border border-gray-200">
            
            <!-- 説明ボックス - 注意点 (内容を更新) -->
            <div class="bg-indigo-50 border-2 border-primary-blue/50 text-indigo-800 p-4 sm:p-5 mb-6 rounded-xl">
                <div class="flex items-center mb-3">
                    <svg class="w-6 h-6 mr-3 text-primary-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <p class="font-bold text-xl">使い方と注意点</p>
                </div>
                
                <p class="font-semibold text-lg text-primary-blue mb-1">【RIS形式 (ファイル読み込み) の場合】</p>
                <ul class="list-disc list-inside text-sm ml-2 space-y-1">
                    <li>J-STAGEからダウンロードした .ris または .txt ファイルを選択してください。</li>
                    <li>複数のファイルを同時に選択可能です。読み込んだ内容は自動的に結合されます。</li>
                    <li>変換精度が高いため、こちらを推奨します。</li>
                </ul>
                
                <p class="font-semibold text-lg text-primary-blue mt-4 mb-1">【テキスト形式 (カンマ区切り) の場合】</p>
                <ul class="list-disc list-inside text-sm ml-2 space-y-1">
                    <li>J-STAGEのページから、著者名からDOI/URLまでの一連のテキスト情報をコピーし、貼り付けてください。</li>
                    <li>文献情報内のカンマの位置に依存して要素を抽出するため、情報欠落や順序の変更があると正しく変換できません。</li>
                </ul>

                <p class="font-semibold text-lg text-accent-red mt-4 mb-1">【共通の注意】</p>
                <ul class="list-disc list-inside text-sm ml-2 space-y-1">
                    <li>変換後の太字（巻）やイタリック（誌名）は、HTMLタグで表現されています。コピー時には通常のテキストになりますが、最終的な文献リストでは手動で適用してください。</li>
                    <li>変換結果は必ずAPA第7版に準拠しているか確認し、必要に応じて修正してください。</li>
                </ul>
            </div>
            
            <div class="flex flex-col lg:flex-row lg:space-x-8">
                
                <!-- 入力エリア -->
                <div class="flex-1 mb-8 lg:mb-0">
                    
                    <!-- 形式選択ラジオボタンの追加 -->
                    <div class="mb-4">
                        <label class="block text-xl font-bold text-gray-700 mb-2">
                            <span class="text-primary-blue mr-2">1.A.</span> 入力データ形式の選択
                        </label>
                        <div class="flex space-x-6">
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="radio" name="input-format" value="text" checked class="form-radio h-5 w-5 text-primary-blue focus:ring-primary-blue" onchange="toggleInputMode('text')">
                                <span class="ml-2 text-gray-700 text-lg">テキスト形式 (カンマ区切り)</span>
                            </label>
                            <label class="inline-flex items-center cursor-pointer">
                                <input type="radio" name="input-format" value="ris" class="form-radio h-5 w-5 text-primary-blue focus:ring-primary-blue" onchange="toggleInputMode('ris')">
                                <span class="ml-2 text-gray-700 text-lg">RIS形式 (ファイル読み込み)</span>
                            </label>
                        </div>
                    </div>
                    
                    <label class="block text-xl font-bold text-gray-700 mb-3">
                        <span class="text-primary-blue mr-2">1.B.</span> 文献情報を入力/読み込み
                    </label>

                    <!-- Text Input Area (Default) -->
                    <div id="text-input-container">
                        <textarea id="input-data-text" rows="15" class="w-full p-4 border-2 border-gray-300 rounded-xl input-focus focus:border-primary-blue transition duration-200 shadow-md" placeholder="J-STAGEの該当ページから、文献情報をコピー＆ペーストしてください。複数文献は改行してください。&#10;&#10;【ジャーナル例 (テキスト形式)】&#10;岡崎 貴世, 水出しで作る冷茶の保存性, 茶業研究報告, 2016, 2016 巻, 122 号, p. 21-25, 公開日 2019/01/01, Online ISSN 1883-941X, Print ISSN 0366-6190, https://doi.org/10.5979/cha.2016.122_21, https://www.jstage.jst.go.jp/article/cha/2016/122/2016_21/_article/-char/ja&#10;&#10;【会議録例 (テキスト形式)】&#10;重森 雅嘉, 村越 暁子, 思いつきによる自殺手段の選択, 日本心理学会大会発表論文集, 2008, 72 巻, 日本心理学会第72回大会, セッションID 2EV029, p. 2EV029, 公開日 2018/09/29, Online ISSN 2433-7609, https://doi.org/10.4992/pacjpa.72.0_2EV029, https://www.jstage.jst.go.jp/article/pacjpa/72/0/72_2EV029/_article/-char/ja"></textarea>
                    </div>

                    <!-- RIS File Input Area (Hidden initially) -->
                    <div id="file-input-container" class="hidden">
                        <input type="file" id="ris-file-input" accept=".ris, .txt" multiple class="w-full text-gray-700 mb-4 p-3 border-2 border-gray-300 rounded-xl bg-white shadow-md cursor-pointer" onchange="handleRISFileSelect()">
                        <textarea id="ris-content-preview" rows="13" readonly class="w-full p-4 border-2 border-gray-200 rounded-xl bg-gray-50 text-gray-800 shadow-inner" placeholder="RISファイルの内容がここに表示されます..."></textarea>
                    </div>

                </div>

                <!-- 出力エリア -->
                <div class="flex-1">
                    <label for="output-apa" class="block text-xl font-bold text-gray-700 mb-3">
                        <span class="text-primary-blue mr-2">2.</span> APA形式に変換されたリスト
                    </label>
                    <div id="output-apa-container" class="space-y-3 h-[43rem] overflow-y-auto w-full p-4 border-2 border-gray-200 rounded-xl bg-gray-50 text-gray-800 shadow-inner">
                        <!-- ここに変換結果が挿入される -->
                        <p class="text-gray-400">変換ボタンを押すと、ここに結果が表示されます。</p>
                    </div>
                </div>
            </div>

            <!-- アクションボタン (横並び) -->
            <div class="flex justify-center mt-6 space-x-4">
                <button onclick="convertAndDisplay()" class="py-4 px-8 text-xl font-extrabold text-white bg-primary-blue hover:bg-indigo-700 rounded-xl shadow-lg transform transition duration-200 hover:scale-[1.01] active:scale-[0.99] focus:outline-none focus:ring-4 focus:ring-primary-blue/50">
                    APA形式に変換
                </button>
                <button id="copy-button" onclick="copyToClipboard()" class="py-4 px-8 text-xl font-bold text-primary-blue bg-indigo-100 hover:bg-indigo-200 rounded-xl shadow-md transform transition duration-200 hover:scale-[1.01] active:scale-[0.99] focus:outline-none focus:ring-4 focus:ring-indigo-300 focus:ring-opacity-50">
                    テキストをコピー
                </button>
            </div>
            
            <!-- メッセージ表示エリア -->
            <div id="message-box" class="mt-4 text-center text-sm font-medium h-6"></div>
        </div>
    </div>

    <script>
        
        // ファイル読み込みの状態を保持するフラグ
        let isFileLoaded = false;

        /**
         * 入力モードに応じてUIを切り替えます。
         */
        function toggleInputMode(format) {
            const textContainer = document.getElementById('text-input-container');
            const fileContainer = document.getElementById('file-input-container');
            
            if (format === 'ris') {
                textContainer.classList.add('hidden');
                fileContainer.classList.remove('hidden');
                document.getElementById('ris-content-preview').placeholder = "RISファイルの内容がここに表示されます...";
            } else {
                fileContainer.classList.add('hidden');
                textContainer.classList.remove('hidden');
            }
            // メッセージをクリア
            showMessage('');
        }

        /**
         * RISファイルが選択されたときに内容を読み込みます。
         */
        function handleRISFileSelect() {
            const fileInput = document.getElementById('ris-file-input');
            const previewEl = document.getElementById('ris-content-preview');
            const files = fileInput.files;
            
            if (files.length === 0) {
                previewEl.value = 'ファイルが選択されていません。';
                isFileLoaded = false;
                return;
            }
            
            previewEl.value = `${files.length}件のファイルを読み込み中です...`;
            isFileLoaded = false;

            const filePromises = Array.from(files).map(file => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsText(file);
                });
            });
            
            Promise.all(filePromises)
                .then(contents => {
                    // 全ファイルのコンテンツを結合し、RISの終端タグ 'ER  -' で区切る
                    // ファイルが複数ある場合、各ファイルの間に区切り 'ER  -\n' を挿入することで、
                    // 後の convertAndDisplay で正しく分割できるようにする。
                    const combinedContent = contents.join('\nER  -\n'); 
                    previewEl.value = combinedContent;
                    isFileLoaded = true;
                    showMessage(`${files.length}件のファイル (${Array.from(files).map(f => f.name).join(', ')}) の読み込みが完了しました。`, 'success');
                })
                .catch(err => {
                    previewEl.value = 'ファイルの読み込み中にエラーが発生しました。';
                    isFileLoaded = false;
                    showMessage('ファイル読み込みエラー', 'error');
                });
        }


        /**
         * J-STAGEのカンマ区切り文字列をAPA形式に変換します。
         * @param {string} jstageString J-STAGEからコピーされた単一行の文献テキスト
         * @returns {string} APA形式のHTML文字列（成功時）またはエラーメッセージ
         */
        function convertToAPAFromText(jstageString) {
            // カンマとスペースで分割し、空要素を削除
            const parts = jstageString.split(/, |,\s*(?=\S)/).map(p => p.trim()).filter(p => p.length > 0);
            
            // 1. DOI/URLの特定 (末尾から)
            let doi = '';
            
            // 末尾からURL/DOIを探す
            for (let i = parts.length - 1; i >= 0; i--) {
                const part = parts[i];
                if (part.startsWith('http')) {
                    if (part.includes('doi.org')) {
                        doi = part;
                    }
                    parts.splice(i, 1); // 抽出したURLをリストから削除
                    // 2つ目のURLはJ-STAGEの直接リンクなので、DOIを優先し、それ以外は破棄
                }
            }
            
            // 2. 年の特定 (20XXまたは19XX)
            let year = '';
            let yearIndex = -1;
            const yearRegex = /\b(19|20)\d{2}\b/;
            
            for (let i = 0; i < parts.length; i++) {
                const part = parts[i];
                if (yearRegex.test(part)) {
                    year = part.match(yearRegex)?.[0] || '';
                    yearIndex = i;
                    break;
                }
            }

            if (yearIndex === -1) {
                return "ERROR: 発行年(YYYY)が見つかりませんでした。";
            }
            
            // 年のインデックスが非常に小さい場合、データが不足している可能性
            if (yearIndex < 2) {
                 return "ERROR: 著者、タイトル、誌名/会議録のいずれかが不足しています。";
            }

            // 3. 著者、タイトル、誌名/会議録名の特定 (J-STAGEの典型的な構造に依存)
            // 誌名/会議録名 (Journal/Proceedings): parts[yearIndex - 1]
            // タイトル (Title): parts[yearIndex - 2]
            // 著者群 (Authors): parts.slice(0, yearIndex - 2)
            let journal = parts[yearIndex - 1]?.trim() || '';
            let title = parts[yearIndex - 2]?.trim() || '';
            let authorParts = parts.slice(0, yearIndex - 2);

            // 著者名整形
            let formattedAuthors;
            if (authorParts.length > 1) {
                // 最後の要素は & で結合
                const lastAuthor = authorParts.pop().trim();
                formattedAuthors = authorParts.map(a => a.trim()).join(', ') + ', & ' + lastAuthor;
            } else if (authorParts.length === 1) {
                formattedAuthors = authorParts[0].trim();
            } else {
                return "ERROR: 著者名が見つかりませんでした。";
            }

            // 4. 巻、号、ページ情報の特定
            let journalInfo = parts.slice(yearIndex + 1);

            let volume = '';
            let issue = '';
            let page = '';
            
            const volumeRegex = /(\d+)\s*巻|\b(\d+)\b(?=\s*巻)/;
            const issueRegex = /(\d+)\s*号|\b(\d+)\b(?=\s*号)/;
            const pageRegex = /p\.?\s*(\S+)/i; 
            
            // 巻の抽出
            let volumeMatch = journalInfo.find(p => volumeRegex.test(p));
            if (volumeMatch) {
                volume = volumeMatch.match(/\d+/)?.[0] || '';
            }
            
            // 号の抽出
            let issueMatch = journalInfo.find(p => issueRegex.test(p));
            if (issueMatch) {
                issue = issueMatch.match(/\d+/)?.[0] || '';
            }
            
            // ページの抽出
            let pageMatch = journalInfo.find(p => pageRegex.test(p));
            if (pageMatch) {
                page = pageMatch.replace(/p\.?\s*/i, '').trim();
            }
            
            // 5. APA形式に結合 (HTMLタグで装飾 - APA7th準拠)
            // 形式: 著者 (年). 論文タイトル. 誌名/会議録名, 巻(号), ページ. DOI
            
            let journalAndVolume = '';
            
            // 誌名/会議録名 (イタリック)
            journalAndVolume += `<i class="italic">${journal}</i>`;
            
            // 巻 (太字)
            if (volume) {
                // 誌名の後にカンマとスペース
                journalAndVolume += `, <b class="font-bold">${volume}</b>`;
            }

            // 号 (括弧つき、非太字)
            if (issue) {
                journalAndVolume += `(${issue})`;
            }
            
            // ページ情報の組み立て
            let pagePart = page ? `, ${page.trim()}` : '';
            
            // 最終APA形式
            let apaReference = `${formattedAuthors} (${year}). ${title}. ${journalAndVolume}${pagePart}.`;

            // DOIの追加
            if (doi) {
                // DOIの前にスペース
                apaReference += ` <a href="${doi}" target="_blank" class="text-primary-blue hover:underline">${doi}</a>`;
            }

            // HTML構造に変換
            return `<div class="bg-gray-50 p-3 rounded-lg border border-gray-200 text-sm break-words">${apaReference}</div>`;
        }

        /**
         * RIS形式の文字列をAPA形式に変換します。
         * @param {string} risString RIS形式の単一文献ブロック
         * @returns {string} APA形式のHTML文字列（成功時）またはエラーメッセージ
         */
        function convertToAPAFromRIS(risString) {
            // 1. RISタグをキー/値のオブジェクトに変換
            const lines = risString.split('\n').map(line => line.trim()).filter(line => line.length > 0);
            const data = {};
            const authorList = [];
            let inRisBlock = false; // TYタグが出現するまでをスキップするためのフラグ

            for (const line of lines) {
                // TYタグが出現したらRISブロック開始とみなす（ヘッダーをスキップ）
                if (!inRisBlock && line.startsWith('TY  -')) {
                    inRisBlock = true;
                }
                
                if (!inRisBlock) continue; // TYタグ以前のヘッダー（Providerなど）をスキップ
                
                // タグ形式の行かチェック
                if (line.length < 5 || line.substring(2, 5) !== '  -') continue;
                
                const tag = line.substring(0, 2).trim();
                const value = line.substring(5).trim();

                if (tag === 'AU') {
                    // 著者名は配列に格納
                    authorList.push(value);
                } else if (tag === 'ER') {
                    // 終了タグはスキップ
                    continue;
                } else if (tag === 'TI' || tag === 'JO' || tag === 'VL' || tag === 'IS' || tag === 'SP' || tag === 'EP' || tag === 'PY' || tag === 'DO') {
                    // タイトルや誌名、ページ情報など、J-STAGEで空行や重複が発生する可能性があるタグについて
                    // 既に値があり、かつ新しい値が空でない場合は、値を連結せず、最初の有効な値を優先する
                    if (!data[tag] || data[tag] === '') {
                        data[tag] = value;
                    }
                } else {
                    data[tag] = value;
                }
            }
            
            // 必須要素のチェック
            if (!data.PY || !data.TI || !data.JO || authorList.length === 0) {
                return "ERROR: RISデータに必要な情報（年(PY), タイトル(TI), 誌名(JO), 著者(AU)）が不足しています。";
            }

            // 2. APA形式への整形
            const year = data.PY;
            const title = data.TI;
            const journal = data.JO; // 誌名/会議録名
            const volume = data.VL || ''; // 巻 (Volume)
            const issue = data.IS || ''; // 号 (Issue)
            // ページ情報（SP:開始ページ, EP:終了ページを結合）
            let page = (data.SP && data.EP) ? `${data.SP}-${data.EP}` : (data.SP || data.EP || '');
            const doi = data.DO || '';

            // 著者名整形: 姓,名 の形式を 姓, 名. に変換
            let formattedAuthors;
            // 著者名を「姓, 名」のAPA形式で整形
            let processedAuthors = authorList.map(author => {
                // J-STAGEのRISは「姓,名」が多い
                const parts = author.split(',');
                if (parts.length > 1) {
                    // 姓 (Family Name) と 名 (Given Name) を取得し、ピリオドを追加しない（APAの日本語文献はピリオドなしが一般的）
                    return `${parts[0].trim()}, ${parts[1].trim()}`;
                }
                return author.trim();
            });

            if (processedAuthors.length > 1) {
                const lastAuthor = processedAuthors.pop().trim();
                formattedAuthors = processedAuthors.join(', ') + ', & ' + lastAuthor;
            } else {
                formattedAuthors = processedAuthors[0].trim();
            }
            
            // 3. APA形式に結合 (HTMLタグで装飾 - APA7th準拠)
            let journalAndVolume = '';
            
            // 誌名/会議録名 (イタリック)
            journalAndVolume += `<i class="italic">${journal}</i>`;
            
            // 巻 (太字)
            if (volume) {
                journalAndVolume += `, <b class="font-bold">${volume}</b>`;
            }

            // 号 (括弧つき、非太字)
            if (issue) {
                journalAndVolume += `(${issue})`;
            }
            
            // ページ情報の組み立て
            let pagePart = page ? `, ${page.trim()}` : '';
            
            // 最終APA形式
            let apaReference = `${formattedAuthors} (${year}). ${title}. ${journalAndVolume}${pagePart}.`;

            // DOIの追加
            if (doi) {
                const fullDoi = doi.startsWith('http') ? doi : `https://doi.org/${doi}`;
                apaReference += ` <a href="${fullDoi}" target="_blank" class="text-primary-blue hover:underline">${fullDoi}</a>`;
            }

            return `<div class="bg-gray-50 p-3 rounded-lg border border-gray-200 text-sm break-words">${apaReference}</div>`;
        }


        /**
         * 入力データからAPA形式に変換し、結果を表示します。
         */
        function convertAndDisplay() {
            const format = document.querySelector('input[name="input-format"]:checked').value;
            const outputContainer = document.getElementById('output-apa-container');
            
            let rawText;
            
            if (format === 'ris') {
                rawText = document.getElementById('ris-content-preview').value;
                if (!rawText.trim() && document.getElementById('ris-file-input').files.length === 0) {
                    showMessage('RISファイルが選択されていないか、内容が空です。', 'error');
                    outputContainer.innerHTML = '<p class="text-gray-400">変換ボタンを押すと、ここに結果が表示されます。</p>';
                    return;
                }
            } else {
                rawText = document.getElementById('input-data-text').value;
            }

            // RIS形式は 'ER  -' タグで文献ブロックを分割
            // テキスト形式は改行で文献を分割
            const references = format === 'ris' 
                ? rawText.split('ER  -').map(block => block.trim()).filter(block => block.length > 0)
                : rawText.split('\n').map(line => line.trim()).filter(line => line.length > 0);

            if (references.length === 0) {
                showMessage('入力エリアに文献情報がありません。', 'error');
                outputContainer.innerHTML = '<p class="text-gray-400">変換ボタンを押すと、ここに結果が表示されます。</p>';
                return;
            }

            let successfulConversions = 0;
            const convertedHtml = references.map(ref => {
                let result;
                
                if (format === 'ris') {
                    // RIS形式の変換ロジックを呼び出し
                    result = convertToAPAFromRIS(ref);
                } else {
                    // テキスト形式の変換ロジックを呼び出し
                    result = convertToAPAFromText(ref);
                }

                if (result.startsWith('ERROR')) {
                    return `<div class="bg-red-100 p-3 rounded-lg border border-red-300 text-red-800 text-sm break-words"><strong>${result}</strong><br>元のデータ: ${ref.substring(0, 200)}...</div>`;
                } else {
                    successfulConversions++;
                    return result;
                }
            }).join('');

            outputContainer.innerHTML = convertedHtml;
            
            showMessage(`${references.length}件中${successfulConversions}件の変換が完了しました。必ず結果を確認してください。`, successfulConversions > 0 ? 'success' : 'error');
        }

        /**
         * ソートされたテキストをクリップボードにコピーします。
         */
        function copyToClipboard() {
            const outputContainer = document.getElementById('output-apa-container');
            const messageEl = document.getElementById('message-box');
            
            // HTMLコンテンツから純粋なテキストを抽出
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = outputContainer.innerHTML;
            
            // エラーメッセージやプレースホルダーを除去
            let rawText = tempDiv.textContent.trim();
            if (rawText.includes('ここに結果が表示されます。') || rawText.includes('ERROR')) {
                rawText = '';
            }

            if (rawText === '') {
                showMessage('有効な変換結果がありません。', 'error');
                return;
            }
            
            // DOIリンクのテキストがURLとして認識されるため、テキストとしてコピーする
            // 念のため、改行コードをクリーンアップ
            rawText = rawText.split('\n').filter(line => line.trim().length > 0).join('\n');

            // クリップボードAPIを使用
            navigator.clipboard.writeText(rawText)
                .then(() => {
                    showMessage('APA形式のテキストをクリップボードにコピーしました！', 'success');
                })
                .catch(err => {
                    // Fallback (通常iframe内では失敗する)
                    console.error('Copy failed:', err);
                    showMessage('コピーに失敗しました。手動でコピーしてください。', 'error');
                });
        }
        
        /**
         * ユーザーメッセージを表示します。
         */
        function showMessage(text, type = 'info') {
            const messageEl = document.getElementById('message-box');
            messageEl.textContent = text;
            
            // クラスをリセット
            messageEl.className = 'mt-4 text-center text-sm font-medium h-6';

            if (type === 'success') {
                messageEl.classList.add('text-green-600', 'font-semibold');
            } else if (type === 'error') {
                messageEl.classList.add('text-red-600', 'font-semibold');
            } else {
                messageEl.classList.add('text-gray-500');
            }

            // 5秒後にメッセージをクリア
            setTimeout(() => {
                if (messageEl.textContent === text) {
                     messageEl.textContent = '';
                }
            }, 5000);
        }
        
        // 初回ロード時にテキストモードを有効化
        document.addEventListener('DOMContentLoaded', () => {
            toggleInputMode('text');
        });
    </script>
</body>
</html>
